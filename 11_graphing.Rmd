---
title: "workbench"
author: "74465159 Ethan Milne"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, echo=FALSE}
source("10_survey_cleaning.R")
```

GRAPHING
```{r}
p <- ggplot(df, aes(x = category, fill = category)) +
  geom_bar() +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Response Categories",
       x = "Category",
       y = "Count") +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none") +
  theme(
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
print(p)
ggsave("response_categories.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
p <- ggplot(df, aes(x = mod_factor, y = response, fill = mod_factor)) +
  geom_boxplot(outlier.shape = NA) +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Distribution of Response by Mod Factor",
    x = "Mod Factor",
    y = "Response"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none") +
  theme(
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
print(p)
ggsave("distribution_responses_mod.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
p <- ggplot(df, aes(x = mod_factor, fill = mod_factor)) +
  geom_bar() +
  scale_fill_brewer(palette = "Set2") +
  facet_wrap(~ category) +
  labs(
    title = "Count of Responses by Mod Factor",
    x = "Mod Factor",
    y = "Count"
  ) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none") +
  theme(
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
print(p)
ggsave("count_responses_mod.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
p <- ggplot(df_origin_time_summary, aes(x = origin, y = avg_time_spent, fill = origin)) +
  geom_boxplot() +
  scale_fill_brewer(palette = "Set2") +
  labs(
    title = "Average Survey Time by Origin",
    x = "Origin",
    y = "Average Time (minutes)"
  ) +
  theme_minimal(base_size = 14) +
  theme(axis.text.x = element_text(angle = 45, hjust = 1), legend.position = "none") +
  theme(
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
print(p)
ggsave("time_origin.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
mean_response <- mean(df$response, na.rm = TRUE)

p <- ggplot(df, aes(x = response)) +
  geom_histogram(aes(y = after_stat(count)), 
                 binwidth = 1, color = "white", fill = "steelblue", alpha = 0.6) +
  geom_density(aes(y = after_stat(count) * 1),
               color = "red", size = 1) +
  geom_vline(xintercept = mean_response, color = "darkgreen", linetype = "dashed", size = 1) +
  labs(title = "Distribution of Responses",
       x = "Response", y = "Count") +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
print(p)
ggsave("mean_response.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
p <- df %>%
  count(category, mod_factor) %>%
  complete(category, mod_factor, fill = list(n = 0)) %>%
  ggplot(aes(x = mod_factor, y = category, fill = n)) +
  geom_tile(color = "white") +
  geom_text(aes(label = n), color = "white") + 
  scale_fill_gradientn(colors = viridis::viridis(10)) +
  labs(title = "Response Category by Mod Factor",
       x = "Mod Factor", y = "Category", fill = "Count") +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
print(p)
ggsave("response_category_mod_factor.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
p <- df %>%
  count(category, branching) %>%
  complete(category, branching, fill = list(n = 0)) %>%
  ggplot(aes(x = branching, y = category, fill = n)) +
  geom_tile(color = "white") +
  geom_text(aes(label = n), color = "white") + 
  scale_fill_gradientn(colors = viridis::viridis(10)) +
  labs(title = "Response Category by Branching",
       x = "Branching", y = "Category", fill = "Count") +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
print(p)
ggsave("response_category_branching.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
p <- ggplot(df, aes(x = category, fill = branching)) +
  geom_bar(position = "dodge") +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Response Category by Branching",
       x = "Response Category",
       y = "Count",
       fill = "Branching") +
  theme_minimal(base_size = 14) +
  theme(
    legend.position = "right",
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
print(p)
ggsave("count_responses_branch.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
p <- df %>%
  group_by(branching) %>%
  summarise(mean_CRD = mean(CRD, na.rm = TRUE)) %>%
  ggplot(aes(x = branching, y = mean_CRD, fill = branching)) +
  geom_col(width = 0.6) +
  scale_fill_brewer(palette = "Set2") +
  labs(title = "Average CRD by Branching",
       x = "Branching",
       y = "Average CRD") +
  theme_minimal(base_size = 14) +
  theme(legend.position = "none") +
  theme(
    legend.position = "none",
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )

print(p)
ggsave("crd_mean.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
p <- ggplot(df, aes(x = category, fill = branching)) +
  geom_bar(position = position_dodge(width = 0.8), width = 0.7) +
  facet_wrap(~ origin, scales = "free_y") +
  scale_fill_brewer(palette = "Set2",
                    name = "Branching",
                    labels = c("Left-branching", "Right branching")) +
  labs(
    title = "Responses by Branching and Origin",
    x = "Response Category",
    y = "Number of Responses"
  ) +
  theme_minimal(base_size = 14) +
  theme(
    panel.grid.major.x = element_blank(),
    panel.grid.minor = element_blank(),
    strip.text = element_text(face = "bold", size = 13, color = "#333333"),
    legend.position = "bottom",
    legend.title = element_text(face = "bold"),
    plot.background = element_rect(fill = "white", color = NA),
    panel.background = element_rect(fill = "white", color = NA)
  )
print(p)
ggsave("origin_responses_branch.png", plot = p, width = 8, height = 6, dpi = 300)
```


```{r}
summary_table <- create_summary_table(df)

kable(summary_table, caption = "Summary of Responses")

save_table_png(summary_table, "summary_table.png")
```


```{r}
category_counts <- df %>%
  group_by(category) %>%
  summarise(count = n()) %>%
  mutate(percent = round(100 * count / sum(count), 1))

kable(category_counts, caption = "Distribution of Response Categories")

save_table_png(category_counts, "category_counts.png", width = 1000, height = 600)
```


```{r}
origin_summary <- summarise_origin_counts(df_unique, df_missing_unique)

kable(
  origin_summary,
  caption = "Survey Response Summaraised by Origin",
  align = c("l", "c", "c", "c"),
  col.names = c("Origin", "Valid Responses", "Invaild Responses", "Total Responses")
)

save_table_png(origin_summary, "origin_summary.png", width = 1000, height = 600)
```
